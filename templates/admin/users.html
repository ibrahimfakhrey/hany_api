{% extends "admin/base.html" %}

{% block title %}Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>
    <div class="breadcrumb">Ø¥Ø¬Ù…Ø§Ù„ÙŠ {{ total }} Ù…Ø³ØªØ®Ø¯Ù…</div>
</div>

{% if success_message %}
<div class="alert alert-success">
    <span>âœ…</span>
    {{ success_message }}
</div>
{% endif %}

{% if error_message %}
<div class="alert alert-error">
    <span>âŒ</span>
    {{ error_message }}
</div>
{% endif %}

<!-- Search & Filters -->
<div class="card">
    <form method="GET" action="/admin/users">
        <div class="search-box">
            <input type="text" name="phone" class="form-control" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..."
                value="{{ search_phone or '' }}">
            <button type="submit" class="btn btn-primary">Ø¨Ø­Ø«</button>
            {% if search_phone %}
            <a href="/admin/users" class="btn btn-outline">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø«</a>
            {% endif %}
        </div>
    </form>

    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <a href="/admin/users"
            class="btn {% if not filter_type %}btn-primary{% else %}btn-outline{% endif %} btn-sm">Ø§Ù„ÙƒÙ„ ({{ total
            }})</a>
        <a href="/admin/paid-users"
            class="btn {% if filter_type == 'paid' %}btn-gold{% else %}btn-outline{% endif %} btn-sm">ğŸ’ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙˆÙ† ({{
            paid_count }})</a>
        <a href="/admin/unpaid-users"
            class="btn {% if filter_type == 'unpaid' %}btn-primary{% else %}btn-outline{% endif %} btn-sm">ğŸ‘¤ ØºÙŠØ±
            Ù…Ø´ØªØ±ÙƒÙŠÙ† ({{ unpaid_count }})</a>
    </div>
</div>

<!-- Users Table -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† {% if filter_type == 'paid' %}Ø§Ù„Ù…Ø´ØªØ±ÙƒÙˆÙ†{% elif filter_type == 'unpaid' %}ØºÙŠØ±
            Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†{% endif %}</h2>
        <a href="/admin/notifications/new" class="btn btn-primary btn-sm">ğŸ”” Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</a>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>
                    <div class="user-info">
                        <div class="user-avatar"
                            style="background: {% if user.is_paid %}var(--gold-accent){% else %}var(--primary-teal){% endif %};">
                            {{ user.name[0] }}</div>
                        <div class="user-details">
                            <div class="name">{{ user.name }}</div>
                            <div class="phone">{{ user.phone }}</div>
                        </div>
                    </div>
                </td>
                <td>
                    {% if user.is_paid %}
                    <span class="badge badge-gold">ğŸ’ Ù…Ø´ØªØ±Ùƒ</span>
                    {% else %}
                    <span class="badge badge-warning">ğŸ‘¤ ØºÙŠØ± Ù…Ø´ØªØ±Ùƒ</span>
                    {% endif %}
                </td>
                <td>{{ user.created_at[:10] }}</td>
                <td>
                    <div class="action-buttons">
                        <a href="/admin/users/{{ user.id }}" class="btn btn-outline btn-sm">ğŸ‘ï¸ Ø¹Ø±Ø¶</a>
                        {% if user.is_paid %}
                        <form method="POST" action="/admin/users/{{ user.id }}/unpaid" style="display: inline;">
                            <button type="submit" class="btn btn-sm" style="background: var(--orange); color: white;"
                                onclick="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ {{ user.name }}ØŸ')">âŒ Ø¥Ù„ØºØ§Ø¡
                                Ø§Ø´ØªØ±Ø§Ùƒ</button>
                        </form>
                        {% else %}
                        <form method="POST" action="/admin/users/{{ user.id }}/paid" style="display: inline;">
                            <button type="submit" class="btn btn-gold btn-sm"
                                onclick="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ {{ user.name }}ØŸ')">âœ… ØªÙØ¹ÙŠÙ„</button>
                        </form>
                        {% endif %}
                        <a href="/admin/notifications/new?user_id={{ user.id }}&user_name={{ user.name }}"
                            class="btn btn-primary btn-sm">ğŸ””</a>
                    </div>
                </td>
            </tr>
            {% endfor %}

            {% if not users %}
            <tr>
                <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray);">
                    <div style="font-size: 50px; margin-bottom: 15px;">ğŸ‘¤</div>
                    <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† {% if search_phone %}ÙŠØ·Ø§Ø¨Ù‚ÙˆÙ† Ø§Ù„Ø¨Ø­Ø«{% endif %}</p>
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}